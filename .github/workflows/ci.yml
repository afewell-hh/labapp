name: CI

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Shellcheck
        run: |
          sudo apt-get install -y shellcheck
          find scripts -name "*.sh" -exec shellcheck {} \;

      - name: YAML Lint
        run: |
          pip install yamllint
          yamllint configs/

  validate:
    name: Validate Packer
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Packer
        uses: hashicorp/setup-packer@main
        with:
          version: '1.10.0'

      - name: Validate standard build
        run: packer validate packer/standard-build.pkr.hcl

      - name: Validate pre-warmed build
        run: packer validate packer/prewarmed-build.pkr.hcl

  test:
    name: Unit Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run orchestrator tests
        run: |
          # TODO: Implement test suite
          echo "Tests will be implemented in future PR"
