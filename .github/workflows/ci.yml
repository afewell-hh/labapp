name: CI

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Shellcheck
        run: |
          sudo apt-get install -y shellcheck
          find scripts -name "*.sh" -exec shellcheck {} \; || true

      - name: YAML Lint
        run: |
          pip install yamllint
          yamllint configs/ || true

  validate:
    name: Validate Packer
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Packer
        uses: hashicorp/setup-packer@main
        with:
          version: '1.10.0'

      - name: Validate standard build
        run: |
          if [ -f packer/standard-build.pkr.hcl ]; then
            packer validate packer/standard-build.pkr.hcl
          else
            echo "Packer file not yet created, skipping validation"
          fi

      - name: Validate pre-warmed build
        run: |
          if [ -f packer/prewarmed-build.pkr.hcl ]; then
            packer validate packer/prewarmed-build.pkr.hcl
          else
            echo "Packer file not yet created, skipping validation"
          fi

  test:
    name: Unit Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run orchestrator tests
        run: |
          # TODO: Implement test suite
          echo "Tests will be implemented in future PR"
